---
name: Feature Epic
about: Template for large feature development (parent issue)
title: "[Epic] カヴィヴァラ応援課金機能"
labels: ["epic", "feature", "enhancement"]
assignees: ""
---

## Overview

<!-- Brief description of the feature epic -->

ユーザーがカヴィヴァラを金銭的に応援できる課金機能を実装する。応援するとヴィヴァポイント(VP)が付与され、累計ポイントに応じて称号を獲得できる。機能制限を伴わない純粋なサポートとして実装し、App Store/Google Play のガイドラインに準拠する。

### Background and Purpose

<!-- この機能が必要な理由、解決したい課題 -->

現在、アプリは完全無料で提供されているが、継続的な開発・運営コスト(サーバー費用、AI API 費用など)をサポートする仕組みが必要である。機能制限による課金ではなく、「応援」という形での課金により、ユーザーとの良好な関係を維持しつつ収益化を図る。

**解決する課題**:

- 開発・運営コストの継続的なサポート体制の構築
- ユーザーと開発者の良好な関係を保ちながらの収益化
- プラットフォームガイドラインに準拠した課金機能の提供

### Expected Impact

<!-- この機能により達成したい成果、KPI -->

**期待する成果**:

- 継続的な運営資金の確保
- ユーザーの参加意識とエンゲージメントの向上
- コミュニティとの良好な関係維持

### Feature Description

<!-- 実装する機能の詳細説明 -->

**主要機能**:

1. **応援プラン**: 3 つの金額プランを提供(¥120/¥370/¥610)
2. **ヴィヴァポイントシステム**: 応援額に応じて VP を付与(1VP/4VP/8VP)
3. **称号システム**: 累計 VP に応じて 7 段階の称号を付与
4. **ローカル保存**: VP と称号を SharedPreferences に保存
5. **プライバシー優先**: 個別の課金履歴は記録せず、累計 VP のみ管理

## User Stories

<!-- As a [user type], I want [goal] so that [reason] -->

### US-1: 応援の気持ちを金銭的に表現したい

As a カヴィヴァラユーザー, I want カヴィヴァラへの感謝を金銭的に表現する so that 継続的な運営を後押しできる

**受入基準**:

- 3 つの金額プランから選択できる(¥120, ¥370, ¥610)
- 各金額に応じた応援メッセージが表示される
- 課金は都度課金(消費型)として実装される
- 全てのユーザーが応援可能(アプリの基本機能は無料のまま)

### US-2: ヴィヴァポイントを貯めて称号を獲得したい

As a カヴィヴァラユーザー, I want 応援で VP を貯めて称号を獲得する so that 自分の貢献度を可視化し達成感を得られる

**受入基準**:

- 応援課金をするとヴィヴァポイントが付与される
- 金額が多いプランほど比例以上にお得なポイントが獲得できる
- 累計 VP に応じて称号が付与される(7 段階)
- 設定画面に現在の称号が表示される
- 応援画面に累計 VP、現在の称号、次の称号までの進捗が表示される
- VP と称号データはローカル(SharedPreferences)に保存される
- 個別の応援履歴(日時・金額の詳細)は記録しない

### US-3: 応援後に感謝を受け取りたい

As a カヴィヴァラユーザー, I want 応援後にカヴィヴァラからの感謝メッセージを受け取る so that 応援が届いたことを実感し満足感を得られる

**受入基準**:

- 応援完了時に感謝のダイアログが表示される
- プランに応じた感謝メッセージが表示される
- 獲得した VP が表示される

### US-4: 課金しても機能が変わらないことを理解したい

As a カヴィヴァラユーザー, I want 応援課金が純粋なサポートであることを明確に理解する so that 誤解なく納得した上で応援できる

**受入基準**:

- 応援画面に「応援課金では機能は追加されません」と明記される
- 「アプリの基本機能は引き続き無料でご利用いただけます」という説明がある
- 透明性のある説明で安心して応援できる

## Acceptance Criteria

<!-- 機能が完成したと判断する条件 -->

- [ ] 設定画面に「💝 カヴィヴァラを応援」メニューが追加されている
- [ ] 応援画面で 3 つのプラン(¥120/¥370/¥610)が選択できる
- [ ] 各プランに獲得 VP(1VP/4VP/8VP)が表示されている
- [ ] 応援完了後に VP が正しく加算される
- [ ] 累計 VP に応じて称号が正しく付与される(7 段階)
- [ ] 応援完了時に感謝ダイアログが表示される
- [ ] VP と称号が SharedPreferences に永続化される
- [ ] アプリ再起動後も VP と称号が保持される
- [ ] 個別の応援履歴(日時・金額)は記録されない
- [ ] 累計 VP のみがローカル保存される
- [ ] サーバーに課金情報は送信されない
- [ ] 「応援」という表現を使用し、「寄付」「投げ銭」を使用していない
- [ ] 「機能は追加されません」という説明が明記されている
- [ ] 「基本機能は無料」という説明が明記されている
- [ ] 消費型アイテムとして実装されている
- [ ] App Store/Google Play のガイドラインに準拠している
- [ ] ユーザーキャンセル時はエラーダイアログを表示しない
- [ ] ネットワークエラー時は適切なメッセージを表示する
- [ ] 商品情報取得失敗時は再試行を促すメッセージを表示する
- [ ] 購入失敗時は二重課金の不安を解消するメッセージを表示する
- [ ] パフォーマンス要件を満たしている(UI 遅延なし)
- [ ] アクセシビリティ要件を満たしている
- [ ] セキュリティ要件を満たしている(課金情報の適切な保護)
- [ ] 既存機能への影響がない(後方互換性維持)
- [ ] 全てのユニットテストが通っている
- [ ] 全てのウィジェットテストが通っている
- [ ] iOS Sandbox での動作確認が完了している
- [ ] Android テストアカウントでの動作確認が完了している
- [ ] 要件定義書が最新の状態である
- [ ] 技術設計書が最新の状態である
- [ ] App Store/Google Play 設定手順が文書化されている
- [ ] テストケースが文書化されている
